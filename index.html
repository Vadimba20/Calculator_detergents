<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Калькулятор экономии моющих средств</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%232c7be5%22/></svg>">

  <!-- CDN библиотеки -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.28/dist/jspdf.plugin.autotable.min.js"></script>

  <style>
    :root{--blue:#2c7be5;--green:#2fcb7c;--muted:#6b7280;--bg:#f6f9ff;--card:#ffffff}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#f3f7fb,#ffffff);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#0b1220}
    .wrap{max-width:1100px;margin:18px auto;padding:12px}
    header{display:flex;align-items:center;gap:12px}
    .logo{width:54px;height:54px;border-radius:10px;background:var(--blue);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    h1{font-size:18px;margin:0}
    p.lead{margin:4px 0 0;color:var(--muted);font-size:13px}
    .top-controls{margin-left:auto;display:flex;gap:8px}
    select,input[type=search]{padding:8px;border-radius:8px;border:1px solid #e6eef8}
    button{cursor:pointer}
    main{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px}
    @media(min-width:980px){main{grid-template-columns:360px 1fr}}
    .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 8px 20px rgba(15,30,60,0.06)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=number], input[type=text]{width:100%;padding:8px;border-radius:8px;border:1px solid #e9f0fb}
    .section-title{font-weight:600;color:var(--blue);margin-bottom:8px}
    .table-wrap{overflow:auto}
    table.dt{width:100%;border-collapse:collapse}
    table.dt thead th{background:#f0f7ff;padding:8px;border-bottom:1px solid #e6f0ff;color:#234}
    table.dt td{padding:6px;border-bottom:1px solid #f4f9ff}
    table.dt input{width:100%;}
    .actions{display:flex;gap:8px;margin-top:10px}
    .btn{background:var(--blue);color:#fff;border:0;padding:8px 12px;border-radius:8px}
    .btn.ghost{background:transparent;border:1px solid var(--blue);color:var(--blue)}
    .btn.secondary{background:#6b7280}
    .remove{color:#e53935;font-weight:700;border:none;background:transparent;cursor:pointer}
    .results-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media(max-width:640px){.results-grid{grid-template-columns:1fr}}
    .stat{padding:12px;border-radius:10px;background:#fff}
    .stat h4{margin:0;font-size:12px;color:var(--muted)}
    .stat p{margin:6px 0 0;font-size:18px;font-weight:700}
    footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">L</div>
      <div>
        <h1 id="appTitle">Калькулятор экономии моющих средств</h1>
        <p class="lead">Покажите клиенту экономию на химии и энергии при переходе на современные средства</p>
      </div>
      <div class="top-controls">
        <select id="langSelect">
          <option value="ru">RU</option>
          <option value="en">EN</option>
        </select>
        <button id="exportBtn" class="btn">Экспорт в PDF</button>
      </div>
    </header>

    <main>
      <!-- Левая колонка -->
      <section class="card">
        <div class="section-title">Общие параметры</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <div><label>Загрузка машины (кг)</label><input id="machineLoad" type="number" min="1" value="10" /></div>
          <div><label>Тариф электроэнергии (₽/кВт·ч)</label><input id="energyTariff" type="number" step="0.01" value="6.5" /></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px">
          <div><label>Рабочих часов в день</label><input id="workHours" type="number" min="1" value="9" /></div>
          <div><label>Уровни скидок</label><input id="discountHint" type="text" /></div>
        </div>

        <hr style="margin:12px 0"/>

        <div class="section-title">Текущие моющие средства</div>
        <div class="table-wrap"><table id="currentTable" class="dt"><thead><tr><th>Название</th><th>Цена</th><th>Вес (кг)</th><th>Дозировка</th><th></th></tr></thead><tbody></tbody></table></div>
        <div class="actions"><button class="btn" id="addCurrent">+ Добавить средство</button><button class="btn ghost" id="clearCurrent">Сбросить</button></div>

        <hr style="margin:12px 0"/>

        <div class="section-title">Наши новые средства</div>
        <div class="table-wrap"><table id="newTable" class="dt"><thead><tr><th>Название</th><th>Цена</th><th>Вес (кг)</th><th>Дозировка</th><th></th></tr></thead><tbody></tbody></table></div>
        <div class="actions"><button class="btn" id="addNew">+ Добавить средство</button><button class="btn ghost" id="clearNew">Сбросить</button></div>
      </section>

      <!-- Правая колонка -->
      <section>
        <div class="card">
          <div class="section-title">Параметры программ</div>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px">
            <div><label>Температура старой программы (°C)</label><input id="oldTemp" type="number" value="60" /></div>
            <div><label>Температура новой программы (°C)</label><input id="newTemp" type="number" value="40" /></div>
            <div><label>Время старой (мин)</label><input id="oldTime" type="number" value="60" /></div>
            <div><label>Время новой (мин)</label><input id="newTime" type="number" value="45" /></div>
          </div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn" id="calcBtn">Рассчитать</button>
            <button class="btn ghost" id="resetBtn">Сбросить всё</button>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="section-title">Результаты</div>
          <div class="results-grid">
            <div class="stat"><h4>Стоимость 1 кг (химия)</h4><p id="costOldChem">—</p></div>
            <div class="stat"><h4>Стоимость 1 кг (химия) — новая</h4><p id="costNewChem">—</p></div>
            <div class="stat"><h4>Энергия на 1 кг — старая</h4><p id="costOldEnergy">—</p></div>
            <div class="stat"><h4>Энергия на 1 кг — новая</h4><p id="costNewEnergy">—</p></div>
          </div>
          <canvas id="chartCompare" height="160"></canvas>
        </div>
      </section>
    </main>

    <footer>index.html — работает локально и на GitHub Pages</footer>
  </div>

  <script>
    const $=id=>document.getElementById(id);
    const money=v=>(typeof v==="number"?v.toFixed(2)+" ₽":"—");
    let state={machineLoad:10,energyTariff:6.5,workHours:9,current:[],new:[],oldTemp:60,newTemp:40,oldTime:60,newTime:45};
    function costPerKg(list){let s=0;list.forEach(it=>{s+= (it.price||0)*((it.dose||0)/(it.weight*1000||1));});return s;}
    function energyKWh(t,min){return 0.05*t+0.1*(min/60);}
    function energyCostPerKg(temp,min,tariff,load){return (energyKWh(temp,min)*tariff)/load;}
    function runsPerDay(min,h){return Math.floor((h*60)/min);}
    let chart;
    function compute(){
      const oldChem=costPerKg(state.current),newChem=costPerKg(state.new);
      const oldE=energyCostPerKg(state.oldTemp,state.oldTime,state.energyTariff,state.machineLoad);
      const newE=energyCostPerKg(state.newTemp,state.newTime,state.energyTariff,state.machineLoad);
      $("costOldChem").innerText=money(oldChem);$("costNewChem").innerText=money(newChem);
      $("costOldEnergy").innerText=money(oldE);$("costNewEnergy").innerText=money(newE);
      const ctx=$("chartCompare").getContext("2d");
      if(!chart){chart=new Chart(ctx,{type:"bar",data:{labels:["Химия","Энергия"],datasets:[{label:"Старая",data:[oldChem,oldE],backgroundColor:"rgba(44,123,229,0.8)"},{label:"Новая",data:[newChem,newE],backgroundColor:"rgba(47,203,124,0.8)"}]},options:{responsive:true,scales:{y:{beginAtZero:true}}}});}
      else{chart.data.datasets[0].data=[oldChem,oldE];chart.data.datasets[1].data=[newChem,newE];chart.update();}
    }
    $("calcBtn").addEventListener("click",compute);
    $("exportBtn").addEventListener("click",async()=>{
      const {jsPDF}=window.jspdf;const doc=new jsPDF({unit:"pt",format:"a4"});doc.setFont("helvetica","");doc.setFontSize(14);doc.text("Отчёт по экономии",40,50);
      const oldChem=costPerKg(state.current),newChem=costPerKg(state.new);
      const oldE=energyCostPerKg(state.oldTemp,state.oldTime,state.energyTariff,state.machineLoad);
      const newE=energyCostPerKg(state.newTemp,state.newTime,state.energyTariff,state.machineLoad);
      const oldT=oldChem+oldE,newT=newChem+newE,saveKg=oldT-newT;
      const newVol=runsPerDay(state.newTime,state.workHours)*state.machineLoad;
      const yearSave=saveKg*newVol*264;
      doc.autoTable({startY:80,head:[["Показатель","Старая","Новая"]],body:[
        ["Стоимость 1 кг (химия)",oldChem.toFixed(2),newChem.toFixed(2)],
        ["Стоимость 1 кг (энергия)",oldE.toFixed(2),newE.toFixed(2)],
        ["Итог (₽/кг)",oldT.toFixed(2),newT.toFixed(2)],
        ["Экономия на 1 кг","",saveKg.toFixed(2)],
        ["Экономия в год","",yearSave.toFixed(2)]
      ]});
      const img=$("chartCompare").toDataURL("image/png",1.0);
      doc.addImage(img,"PNG",40,doc.lastAutoTable.finalY+20,500,200);
      doc.save("savings_report.pdf");
    });
  </script>
</body>
</html>
